<h1 class="xl-top-margin">Checkout</h1>
<div class="row">
  <div class="col-sm-6 box-with-shadow">
    <h3>Payment Details</h3>
    <%= form_for @order, url: checkout_submit_path, :html => {:class => "form-group"} do |f| %>
      <% if @order.errors.any? %>
        <div id="error_explanation">
          <ul>
          <% @order.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
          </ul>
        </div>
      <% end %>
      <div class="field">
        <%= f.label :cc_name, "Name on Credit Card" %><br>
        <%= f.text_field :cc_name, class: 'form-control', :required => true  %>
      </div>
      <div class="field">
        <%= f.label :email %><br>
        <%= f.text_field :email, class: 'form-control', :required => true  %>
      </div>
      <div class="field">
        <%= f.label :street %><br>
        <%= f.text_field :street, class: 'form-control', :required => true  %>
      </div>
      <div class="field">
        <%= f.label :city %><br>
        <%= f.text_field :city, class: 'form-control', :required => true  %>
      </div>
      <div class="field">
        <%= f.label :state %><br>
        <%= f.text_field :state, class: 'form-control', :required => true  %>
      </div>
      <div class="field">
        <%= f.label :zip %><br>
        <%= f.text_field :zip, class: 'form-control', :required => true  %>
      </div>
      <div class="field">
        <%= f.label :cc_num, "Credit Card Number" %><br>
        <%= f.text_field :cc_num, class: 'form-control', :required => true  %>
      </div>
      <div class="field">
        <%= f.label :cc_exp, "Credit Card Expiration Date" %><br>
        <%= f.date_select :cc_exp, class: 'form-control', :required => true  %>
      </div>
      <div class="field">
        <%= f.label :cc_cvv, "Credit Card CVV" %><br>
        <%= f.number_field :cc_cvv, class: 'form-control', :required => true  %>
      </div>
      <br>
      <div class="actions">
        <%= f.submit value: "Place My Order", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
  <div class="col-xs-12 col-sm-5 col-sm-offset-1 box-with-shadow">
    <h3>Purchase Summary</h3>
    <table class="table table-hover">
      <thead>
        <th>Product</th>
        <th class="text-center">Quantity</th>
        <th class="text-right">Subtotal</th>
      </thead>
      <% total = 0 %>
      <% @order_items.each do |oi| %>
      <tr>
        <td><%= oi.product.name %></td>
        <td class="text-center"><%= oi.quantity %></td>
        <% subtotal = oi.product.price * oi.quantity %>
        <% total += subtotal %>
        <td class="text-right"><%= dollar_price(subtotal) %></td>
      </tr>
      <% end %>
      <tfoot>
        <td></td>
        <td class="text-right"><strong>Total: </strong></td>
        <td class="text-right"><%= dollar_price(total) %></td>
      </tfoot>
    </table>
  </div>
</div>
